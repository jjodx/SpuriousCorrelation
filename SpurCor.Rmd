---
title: "Simulating for understanding p-values"
author: "Jean-Jacques Orban de Xivry"
date: "April 8, 2019"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Hmisc) # for rcorr
library(MASS) # for mvnorm
library(ggplot2)
```

## Introduction



When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## simulating a single correlation R=0

In the first step of this tutorial, we will build two variables x and y that are compmletely random (Gaussian distribution with mean=0 and standard deviation = 1). Each variable will be sampled 20 times. Each sampled element of x (xi) with an element of y (yi) to have pairs of (xi,yi). Then, we will compute the correlation between x and y.
Off course, one should not expect any correlation between x and y as these are sampled from random distribution.
One can achieve that in R by using the `mvrnorm` function from the MASS package. To draw 20 samples from a normal distribution, we can have `x=mvrnorm(20,0,1,empirical = FALSE)` and `y=mvrnorm(20,0,1,empirical = FALSE)`
```{r, echo=FALSE}
set.seed(123)# to make sure everybody gets the same results
x=mvrnorm(20,0,1,empirical = FALSE)
y=mvrnorm(20,0,1,empirical = FALSE)
R<-rcorr(x,y)
Scatter1 <- data.frame(x,y)
PP4 <- ggplot(Scatter1, aes(x=x, y=y)) +
  geom_point()+
  geom_smooth(method='lm',formula=y~x)+
  labs(title = "",x="Random variable 1", y="Random variable 2")
```
Together, these two variables are uncorrelated with a correlation coefficient R= `r format(R$r[1,2], digits = 3)` (p-value = `r format(R$P[1,2], digits = 3)`). This is expected as we sampled two random variables. Therefore, the correlation between these two samples should be non-significant as there is not link between them.
````{r, echo=FALSE} 
PP4
```

## What is the expected p-value distribution if there are no correlations

## simulating a single correlation R=x

## What is the expected p-value distribution if there is a correlation

## simulating multiple correlations, bootstrap

## How sensisitive are correlations to one outlier?

## Solution to the outlier problem
### robust parametric correlation
### non-parametric correlation - Spearman

## How sensisitive are correlations to subgroups?

## Solution to the subgroup problem
### Spearmann is not a solution
### Taking subgroups into account

## The multiple comparison problem

## extending this line of thought to the T-test



You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
